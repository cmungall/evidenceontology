### Navigation

* [Getting Started](https://github.com/evidenceontology/evidenceontology/tree/master/src/ontology/README-editors.md#getting-started)
* [Editing](https://github.com/evidenceontology/evidenceontology/tree/master/src/ontology/README-editors.md#editing)
    * [Adding classes](https://github.com/evidenceontology/evidenceontology/tree/master/src/ontology/README-editors.md#adding-classes)
    * [Adding classes with ROBOT](https://github.com/evidenceontology/evidenceontology/tree/master/src/ontology/README-editors.md#adding-classes-with-robot)
    * [Reasoning](https://github.com/evidenceontology/evidenceontology/tree/master/src/ontology/README-editors.md#run-the-reasoner)
    * [Committing](https://github.com/evidenceontology/evidenceontology/tree/master/src/ontology/README-editors.md#commit)
* [Releasing](https://github.com/evidenceontology/evidenceontology/tree/master/src/ontology/README-editors.md#make-release)


# Getting Started
-------
### Download Protégé
Latest version is 5.5.0. [Download here](http://protege.stanford.edu/products.php#desktop-protege) and follow the documentation on their wiki.

If you have never used Protégé, we recommend giving the [user documentation](https://protegewiki.stanford.edu/wiki/Protege4UserDocs) a quick read before getting started.

### Clone the ECO repository
```
git clone https://github.com/evidenceontology/evidenceontology.git
```

### Sync with the repo
Always do this before commencing editing:

```
cd evidenceontology
git pull
```

# Editing
-------
### Minor Edits
Open `eco-edit.owl` in Protégé, make changes as necessary. Save your work, then [commit](https://github.com/evidenceontology/evidenceontology/tree/master/src/ontology/README-editors.md#commit).

### Adding Classes
Each ECO editor has a specified ID range in `eco-idranges.owl`. After acquiring an ID range, you may begin adding classes. When creating new classes in Protégé, make sure your application is set up to create the appropriate IRIs. Follow these steps to configure:
1. Go to File -> Preferences, and select **New Entities** tab

2. Edit **Entity IRI** settings
    * Start with: Specified IRI
      * Enter in: http://purl.obolibrary.org/obo
    * Followed by: /
    * End with: Auto-generated ID
    
3. Edit **Entity Label** settings
    * Select "Same as label renderer"
    
4. Edit **Auto-generated ID** settings
    * Select "Numeric (iterative)"
    * Prefix: ECO_000 (or however many leading zeros to create a 7-digit ID)
      * i.e. if your range is >100, <=400, you would have 4 leading zeros
    * Digit count: 3, 4, or 5 (depending on your ID range)
      * i.e. if your range is >3000, <=4000, your digit count is 4
    * Start: your first ID
      * i.e. if your range is >1000, <=2000, your first ID is 1001
    * End: your last ID
      * i.e. 2000 from the above example
    * Check "Remember last ID between sessions" *
    
5. Click OK to save changes

\* *This option will impact the IRI generation for other ontologies you are working on in Protégé. If you prefer, you can leave this unchecked, but you will have to update the settings each time you begin a new session.*

#### To add a new class:
1. Browse to the parent class (always in `eco-edit.owl`) and select this class in the Class hierarchy view

2. Click the **Add Subclass** button (left-most button under the Class hierarchy header)
    * OR: Edit -> Create Child, OR: Ctrl+E
    
3. Enter class name in the dialog box (i.e. "xyz evidence")
    * Check auto-generated IRI for accuracy

4. Add annotations in the **Annotations** view by clicking the + sign

5. Add required annotations (make sure to select "xsd:string" as the type):
    * rdfs:label
        * This is auto-generated by Protégé, but may not be the correct type (xsd:string)
    * id ("ECO:xxxxxxx")
    * has_obo_namespace ("eco")
    * definition ("A type of X that ...")
    * definition source (source in the format namespace:identifier (i.e. PMID:123))
    * term editor (class author)
    * creation_date (yyyy-mm-ddThh:mm:ssZ)
    
6. Add optional annotations (make sure to select "xsd:string" as the type):
    * ontology term requester
    * example of usage
    * rdfs:comment
    * has_broad_synonym
    * has_exact_synonym
    * has_narrow_synonym
    * has_related_synonym
    
7. Proof-read and save your changes

#### To add a "used in ... assertion" (manual or automatic) class:
1. Follow above steps
    * Label should be "X evidence used in ... assertion"
    * Definition should be "A type of X evidence that is used in ... assertion.
        * i.e. "experimental evidence used in manual assertion": A type of experimental evidence that is used in a manual assertion.
        
2. Add equivalence statement
    * Find **Description** view (usually below annotations)
    * Click the + next to **Equivalent To** and select **Class expression editor**
    * Enter: 'X (parent) evidence' and (used_in some '... assertion')
        * i.e. "high throughput evidence used in manual assertion": 'high throughput evidence' and (used_in some 'manual assertion') 
        * All classes must be enclosed in single quotes, unless the label is only one word
    * Click OK

3. Add subclass statement
    * In the same view, click the + next to **SubClass Of** and select **Class expression editor**
    * Enter: used_in some '... assertion'
        * Substitute with either 'manual' or 'automatic'
    * Click OK
    
3. [Run reasoner](https://github.com/evidenceontology/evidenceontology/tree/master/src/ontology/README-editors.md#run-the-reasoner) to ensure no errors were made

4. Proof-read and save changes

### Adding Classes with ROBOT
For addition or update of multiple classes at once, we recommend the use of [ROBOT](https://github.com/ontodev/robot). Visit their GitHub (linked) for installation instructions.

ROBOT includes a template tool to build OWL files from a CSV spreadsheet. The easiest way to edit these spreadsheets is in Excel, then save as CSV. Start off with our ECO ROBOT template and add your desired classes. The first row contains headers, which ROBOT ignores. The second row contains the template string for the OWL conversion. These two rows should not be changed. 

Our template includes the following (headers in bold are required):

| Header        | Template String          | Description  |
| ------------- |--------------------------| -----|
| **ID** | ID | Unique ID for class (ECO:xxxxxxx).|
| **OBO ID** | A oboInOwl:id | Annotation property to display ID, should be the same as ID. |
| **Label** | A rdfs:label | Textual label for class ('...evidence'). |
| **Definition** | A obo:IAO_0000115 | Aristotelian definition ('A type of [parent evidence]...'). |
| **Source** | A obo:IAO_0000119 | Reference to the source for definition (i.e. PMID, the person, etc.) |
| **Namespace** | A oboInOwl:hasOBONamespace | Should always be 'eco'.
| **created by** | A oboInOwl:created_by | Reference to the creator of class (i.e. jdoe). |
| **Date** | A oboInOwl:creation_date | Formatted date (i.e. 2016-12-29T16:01:01Z). |
| **Class Type** | CLASS_TYPE | Specifies if the class expression will be for a subclass or equivalent class*. |
| **ParentIRI** | CI | ID of parent class (ECO:xxxxxxx). |
| Exact Synonym | A oboInOwl:hasExactSynonym | Synonym is interchangeable with the class. |
| Broad Synonym | A oboInOwl:hasBroadSynonym | Synonym is less specific than the class. |
| Narrow Synonym | A oboInOwl:hasNarrowSynonym | Synonym is more specific than the class. |
| Related Synonym | A oboInOwl:hasRelatedSynonym | Synonym is not exactly the same, but not broader or narrower. |
| Term Requester | A obo:IAO_0000234 | The person, group, or project that requested the term. |
| Example of Use | A obo:IAO_0000112 | Clarification of how the term should be used for annotations. |
| Comment | A rdfs:comment | Clarification of definition. See above for use cases. |
| Equivalent | C % and (used_in some 'automatic/manual assertion') | This is used only for either automatic or manual assertion terms. The value for this will have the parent class of an assertion term. Keep only one, either automatic or manual in the previous cell (C % and (used_in some 'automatic/manual assertion') based on the assertion term to be made |
| Used in | C used_in some % | It can have values either automatic or manual assertion based on the assertion term to be made |
| has GO evidence code | A obo:ECO_9000002 | usually this is the GO code associated with the parent assertion term |


\* *CLASS_TYPE should generally be 'subclass', unless a manual/automatic assertion class or OBI mapping is being created. In that case, 'equivalent' should be used. 'equivalent' classes do not need an entry in the ParentIRI column, rather they will have a different column with a ROBOT string that begins with a 'C'. See the other templates below for examples.*

This is not an exhaustive list of the annotation properties used in ECO, but it is what is recommended for a new class. Synonym and Comment are not necessary, but may add clarity. Any cell that is left blank will not be translated into OWL.

In this sub-directory, there are various other template examples which cover different scenarios. The template described above works for general class additions. Please read the 'Comment' column for more information in these templates.
* [Manual Assertion Template](https://github.com/evidenceontology/evidenceontology/blob/master/src/deprecated/editors/manual-robot-template.csv) - new class + 'used in manual assertion' child 
* [OBI Mapping Template](http://github.com/evidenceontology/evidenceontology/blob/master/src/deprecated/editors/obi-mapping-template.csv) - addition of OBI mappings to existing classes
* [New Class with Mapping Template](https://github.com/evidenceontology/evidenceontology/blob/master/src/deprecated/editors/new-with-mapping-template.csv) - new class addition + OBI mappings
* [Full New Class Template](https://github.com/evidenceontology/evidenceontology/blob/master/src/deprecated/editors/full-robot-template.csv) - new class + 'used in manual assertion' child + OBI mappings

Once you are done adding classes to the spreadsheet, save it as CSV and run the following command:
```
robot template --template [PATH_TO_CSV] 
    --prefix "eco: http://purl.obolibrary.org/obo/eco#" \
    --ontology-iri "http://purl.obolibrary.org/obo/eco.owl" \
    --output [NAME_OF_OUTPUT.OWL]
```
Replace `[PATH_TO_CSV]` with the path to your file (i.e. `~/Documents/template.csv`) and `[NAME_OF_OUTPUT.OWL]` with a temporary name such as `new-classes.owl`. This command will generate a new OWL file consisting of your classes. Placeholders with the parent IDs will be created for super classes. 

Check your new OWL file to make sure everything looks good, then merge it into `eco-edit.owl` (this should be done from the evidenceontology sub-directory):
```
robot merge --input [PATH_TO_PREVIOUS_OUTPUT.OWL] 
    --input eco-edit.owl \
    --output [NAME_OF_OUTPUT.OWL]
```
Replace `[PATH_TO_PREVIOUS_OUTPUT.OWL]` with the path to the output from the template step (i.e. `~/Documents/new-classes.owl`). The output (`[NAME_OF_OUTPUT.OWL]`) will be a complete file which you can replace the original `eco-edit.owl` with (make sure to give it the same name!).

It is also possible to template and merge at the same time, though it may make proof-reading more difficult.
```
robot template --template [PATH_TO_CSV] 
    --merge-before --input eco-edit.owl \
    --output [NAME_OF_OUTPUT.OWL]
```

**Please note:**
ROBOT generates OWL files in RDF/XML syntax. `eco-edit.owl` is saved in OWL Functional Syntax. *Make sure* to open your final file (after merging) in Protege, SAVE AS and select 'OWL Function Syntax'. Simply replace your generated file with this new save to keep the format consistent.

### Run the Reasoner

Before saving any changes, it is a good idea to run the reasoner. The ELK reasoner should be selected in Protégé (ELK 0.4.3 for Protege-OWL 5). Start the reasoner, and ignore the alerts that state reasoning may be incomplete and that axiom is ignored. For more information on ELK, [visit the wiki](http://protegewiki.stanford.edu/wiki/ELK).

### Commit
From your local evidenceontology directory:
```
git add eco-edit.owl
git commit -m "my fabulous edits" eco-edit.owl
git push origin master
```

You can automatically close a tracker item from a commit like this:
```
git commit -m "Added inferred-by-blog-article, Fixes #20" eco-edit.owl
```
(substitute "20" with your issue number here)

For experimental edits (i.e. ontology harmonization, structural changes, adding new branches, etc.), it is not always best to immediately commit the edits to the master branch. To create a new testing branch:
```
git checkout -b <new branch name>
```
This command creates a new branch, and switches you to it. Make sure to push your changes to add your branch to the remote. For information on branching and merging, check out the [Git Documentation](https://git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging).

To return to the master branch:
```
git checkout master
```
You can use the same command (replacing master with the branch name) to return to a different branch.

### Post-editing steps

* Resolve tracker item


### Make Release
-----

The eco-edit file is generally not visible to the public (of course, they can find it in GitHub if they try). The editors are free to make changes they are not yet comfortable releasing. Releases are typically done the first Friday of the month, unless there is an urgent need for an earlier release. Regardless, only **one** release should be done per day.

In order to do a release, [OWLTools](https://github.com/owlcollab/owltools) is required (OORT is used). Visit their GitHub (linked) for download and setup instructions. You will need to add OWLTools-Oort to your PATH (Environment Variables in Windows, `.bash_profile` for Mac and Linux).

When ready for release, first enter:

    make release

This generates derived files such as eco.owl and eco.obo. The versionIRI will be added. Immediately commit and push these files.

IMMEDIATELY AFTERWARDS (do *not* make further modifications) go here:

 * https://github.com/evidenceontology/evidenceontology/releases
 * https://github.com/evidenceontology/evidenceontology/releases/new

The value of the "Tag version" field MUST be

    vYYYY-MM-DD

The initial lowercase "v" is *REQUIRED*. The YYYY-MM-DD *MUST* match what is in the versionIRI of the derived eco.owl (data-version in eco.obo).

Release title should be YYYY-MM-DD, optionally followed by a title (e.g. "january release"). This is not as important as the "Tag version"

**Check that you have the tag version correct, then click "publish release".**

An example:

 * http://purl.obolibrary.org/obo/eco/releases/2015-07-03/eco.owl

This redirects to the version of ECO from this GitHub release:

 * https://github.com/evidenceontology/evidenceontology/releases/tag/v2015-07-03

For questions on this contact Chris Mungall or email obo-admin@obofoundry.org
